---
import BaseLayout from '../../layouts/BaseLayout.astro';
import AdminLayout from '../../components/admin/AdminLayout.astro';
import { buildApiUrl } from '../../lib/api';

const customers = [
  { name: 'Falcon Ridge Capital', status: 'Active', plan: 'Pro', created: '2024-04-18' },
  { name: 'Northwind Markets', status: 'Invited', plan: 'Free', created: '2024-05-02' },
  { name: 'Vanguard Desk', status: 'Active', plan: 'Enterprise', created: '2023-12-11' }
];

const createCustomerEndpoint = buildApiUrl('/admin/customers');
---
<BaseLayout title="Admin | Customers" description="Manage customer accounts, permissions, and lifecycle states.">
  <AdminLayout heading="Customers" description="Provision new desks, audit permissions, and review adoption metrics.">
    <div class="space-y-10">
      <div class="gs-panel overflow-hidden">
        <table class="min-w-full divide-y divide-border/60 text-sm">
          <thead class="bg-surface/70 text-xs uppercase tracking-[0.2em] text-muted">
            <tr>
              <th class="px-4 py-3 text-left">Customer</th>
              <th class="px-4 py-3 text-left">Status</th>
              <th class="px-4 py-3 text-left">Plan</th>
              <th class="px-4 py-3 text-left">Created</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-border/60 bg-bg text-sm">
            {customers.map((customer) => (
              <tr>
                <td class="px-4 py-3 font-medium text-text">{customer.name}</td>
                <td class="px-4 py-3 text-muted">{customer.status}</td>
                <td class="px-4 py-3 text-muted">{customer.plan}</td>
                <td class="px-4 py-3 text-muted">{customer.created}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <form
        id="customer-create"
        class="gs-panel gs-form grid gap-4 p-6"
        method="post"
        data-api-form
        data-endpoint={createCustomerEndpoint}
        data-method="POST"
        data-include-credentials
        data-credentials="include"
        data-status-target="#customer-create-status"
        data-success-message="Customer submitted to API."
        data-pending-message="Creating customerâ€¦"
        data-error-message="Request failed. Verify connectivity and try again."
        data-reset-on-success
      >
        <div>
          <h2 class="font-display text-xl text-text">Create customer</h2>
          <p class="text-sm text-muted">Submit a customer profile to <code>/v1/admin/customers</code>.</p>
        </div>
        <div class="grid gap-4 md:grid-cols-3">
          <label class="flex flex-col gap-1 text-sm">
            <span class="font-medium text-text">Name</span>
            <input name="name" required />
          </label>
          <label class="flex flex-col gap-1 text-sm">
            <span class="font-medium text-text">Email</span>
            <input type="email" name="email" required />
          </label>
          <label class="flex flex-col gap-1 text-sm">
            <span class="font-medium text-text">Plan</span>
            <select name="plan" required>
              <option value="free">Free</option>
              <option value="pro">Pro</option>
              <option value="enterprise">Enterprise</option>
            </select>
          </label>
        </div>
        <label class="flex flex-col gap-1 text-sm">
          <span class="font-medium text-text">Notes</span>
          <textarea class="h-24" name="notes"></textarea>
        </label>
        <div class="flex items-center gap-4">
          <button class="gs-btn-primary gs-btn-sm" type="submit">Create</button>
          <p id="customer-create-status" class="gs-muted-callout"></p>
        </div>
      </form>
    </div>
  </AdminLayout>
</BaseLayout>
